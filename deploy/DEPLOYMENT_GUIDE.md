# å››å¤§éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”ä¸ä½¿ç”¨æŒ‡å—

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”è¡¨

| æ–¹æ¡ˆ | è§¦å‘æ–¹å¼ | éš¾åº¦ | è‡ªåŠ¨åŒ– | é€‚ç”¨åœºæ™¯ |
|-----|--------|------|--------|---------|
| **æ–¹æ¡ˆ 1** | æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬ | â­ ä½ | âŒ æ—  | æµ‹è¯•éƒ¨ç½²ã€ç´§æ€¥ä¿®å¤ |
| **æ–¹æ¡ˆ 2** | git push æ¨é€ | â­â­ ä¸­ | âœ… å®Œå…¨ | å°å›¢é˜Ÿã€è‡ªæ‰˜ç®¡æœåŠ¡å™¨ |
| **æ–¹æ¡ˆ 3** | GitHub push | â­â­â­ é«˜ | âœ…âœ… å®Œå…¨ | ä¸“ä¸šå›¢é˜Ÿã€ä¼ä¸šçº§åº”ç”¨ |
| **æ–¹æ¡ˆ 4** | äº¤äº’å¼è„šæœ¬ | â­â­ ä¸­ | ğŸ“Š åŠè‡ªåŠ¨ | å¼€å‘é˜¶æ®µã€å¤šæ­¥éª¤æµç¨‹ |

---

## ğŸš€ æ–¹æ¡ˆ 1ï¼šSSH ç›´æ¥æ‰§è¡Œï¼ˆå¿«é€Ÿéƒ¨ç½²ï¼‰

### ç‰¹ç‚¹
- âœ… æœ€ç®€å•ï¼Œæ— éœ€é…ç½®
- âœ… å®æ—¶åé¦ˆéƒ¨ç½²çŠ¶æ€
- âŒ éœ€è¦æ‰‹åŠ¨æ‰§è¡Œ
- âŒ æ— æ³•é›†æˆåˆ° CI/CD

### ä½¿ç”¨æ­¥éª¤

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/ssngyu/Desktop/my-workspace/my-app

# 2. æ‰§è¡Œéƒ¨ç½²è„šæœ¬
chmod +x deploy-remote.sh
./deploy-remote.sh

# 3. ç¡®è®¤æ‰§è¡Œï¼ˆè¾“å…¥ yï¼‰
```

### å‘½ä»¤è¡Œå¿«é€Ÿæ–¹å¼

```bash
# ä¸åˆ›å»ºè„šæœ¬ï¼Œç›´æ¥æ‰§è¡Œ
ssh root@47.100.82.151 "cd /var/www/my-next-app && git pull origin master && npm install && npm run build && pm2 stop my-next-app || true && pm2 start ecosystem.config.cjs --env production && sudo systemctl reload nginx"
```

### ä½•æ—¶ä½¿ç”¨
- ğŸ”§ å¿«é€Ÿæµ‹è¯•æŸä¸ªåŠŸèƒ½
- ğŸ› ç´§æ€¥ä¿®å¤çº¿ä¸Šé—®é¢˜
- ğŸ“‹ ä¸€æ¬¡æ€§éƒ¨ç½²
- ğŸ‘¨â€ğŸ’» å¼€å‘é˜¶æ®µå°è§„æ¨¡éƒ¨ç½²

---

## ğŸ¯ æ–¹æ¡ˆ 2ï¼šGit Hook è‡ªåŠ¨éƒ¨ç½²ï¼ˆæœ€çµæ´»ï¼‰

### ç‰¹ç‚¹
- âœ… æ¨é€å³éƒ¨ç½²ï¼Œå®Œå…¨è‡ªåŠ¨
- âœ… æ— éœ€å¤–éƒ¨æœåŠ¡ä¾èµ–
- âœ… å¯ä»¥ç¦»çº¿å·¥ä½œ
- âš ï¸ éœ€è¦ä¸€æ¬¡æ€§é…ç½®
- âš ï¸ éƒ¨ç½²æ—¥å¿—åœ¨æœåŠ¡å™¨ç«¯

### å®Œæ•´é…ç½®æ­¥éª¤

### ç¬¬ 1 æ­¥ï¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºè£¸ä»“åº“

```bash
# æœ¬åœ°æ‰§è¡Œä»¥ä¸‹å‘½ä»¤
chmod +x setup-git-hook.sh
./setup-git-hook.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨åœ¨æœåŠ¡å™¨ä¸Šï¼š
1. åˆ›å»º `/var/repo/my-next-app.git` è£¸ä»“åº“
2. åˆ›å»º `post-receive` hook
3. é…ç½®è‡ªåŠ¨éƒ¨ç½²è„šæœ¬
4. ç”Ÿæˆæœ¬åœ°é…ç½®è¯´æ˜

### ç¬¬ 2 æ­¥ï¼šæœ¬åœ°é…ç½®

```bash
# æ·»åŠ æœåŠ¡å™¨è¿œç¨‹
git remote add server root@47.100.82.151:/var/repo/my-next-app.git

# éªŒè¯
git remote -v
# åº”è¯¥æ˜¾ç¤º:
# origin  https://github.com/your-username/my-next-app.git (fetch)
# server  root@47.100.82.151:/var/repo/my-next-app.git (fetch)
```

### ç¬¬ 3 æ­¥ï¼šæ¨é€å¹¶è‡ªåŠ¨éƒ¨ç½²

```bash
# ä¿®æ”¹ä»£ç å
git add .
git commit -m "feat: æŸä¸ªåŠŸèƒ½"

# æ¨é€åˆ° GitHubï¼ˆå¯é€‰ï¼‰
git push origin master

# æ¨é€åˆ°æœåŠ¡å™¨ï¼ˆè‡ªåŠ¨è§¦å‘éƒ¨ç½²ï¼‰
git push server master
```

### ç¬¬ 4 æ­¥ï¼šæŸ¥çœ‹éƒ¨ç½²çŠ¶æ€

```bash
# æŸ¥çœ‹å®æ—¶éƒ¨ç½²æ—¥å¿—
ssh root@47.100.82.151 "tail -f /var/log/my-next-app-deploy.log"

# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
ssh root@47.100.82.151 "pm2 status"
```

### ä½•æ—¶ä½¿ç”¨
- ğŸ‘¥ å°å›¢é˜Ÿåä½œ
- ğŸ”„ æŒç»­é›†æˆå¼€å‘
- ğŸ¢ å†…éƒ¨éƒ¨ç½²
- âš¡ å¿«é€Ÿè¿­ä»£

---

## ğŸ¤– æ–¹æ¡ˆ 3ï¼šGitHub Actions è‡ªåŠ¨åŒ–ï¼ˆä¼ä¸šçº§ï¼‰

### ç‰¹ç‚¹
- âœ… GitHub åŸç”Ÿæ”¯æŒ
- âœ… å®Œæ•´çš„ CI/CD æµç¨‹
- âœ… å¯ä»¥è¿è¡Œæµ‹è¯•ã€ä»£ç æ£€æŸ¥
- âœ… éƒ¨ç½²è®°å½•é€æ˜å¯æŸ¥
- âš ï¸ éœ€è¦é…ç½® Secrets
- âš ï¸ ä¾èµ– GitHub æœåŠ¡

### å®Œæ•´é…ç½®æ­¥éª¤

### ç¬¬ 1 æ­¥ï¼šæŸ¥çœ‹å·²ç”Ÿæˆçš„æ–‡ä»¶

```bash
# æ–‡ä»¶å·²åœ¨é¡¹ç›®ä¸­
cat .github/workflows/deploy.yml

# æŸ¥çœ‹é…ç½®è¯´æ˜
cat GITHUB_ACTIONS_SETUP.md
```

### ç¬¬ 2 æ­¥ï¼šç”Ÿæˆæˆ–é…ç½® SSH å¯†é’¥

```bash
# æŸ¥çœ‹ç°æœ‰ SSH å¯†é’¥
ls -la ~/.ssh/

# å¦‚æœæ²¡æœ‰ id_ed25519ï¼Œç”Ÿæˆæ–°çš„
ssh-keygen -t ed25519 -C "your-email@example.com"

# æŸ¥çœ‹å…¬é’¥
cat ~/.ssh/id_ed25519.pub

# æŸ¥çœ‹ç§é’¥ï¼ˆå¤åˆ¶åˆ° GitHub Secretsï¼‰
cat ~/.ssh/id_ed25519
```

### ç¬¬ 3 æ­¥ï¼šé…ç½® GitHub Secrets

1. è¿›å…¥ GitHub é¡¹ç›®é¡µé¢
2. **Settings** â†’ **Secrets and variables** â†’ **Actions**
3. **New repository secret**

**æ·»åŠ  Secret 1: SSH_PRIVATE_KEY**
- Name: `SSH_PRIVATE_KEY`
- Value: ä½ çš„ SSH ç§é’¥å…¨æ–‡ï¼ˆä» `cat ~/.ssh/id_ed25519`ï¼‰

**æ·»åŠ  Secret 2: SLACK_WEBHOOK**ï¼ˆå¯é€‰ï¼Œç”¨äºé€šçŸ¥ï¼‰
- Name: `SLACK_WEBHOOK`
- Value: ä½ çš„ Slack Webhook URL

### ç¬¬ 4 æ­¥ï¼šæ·»åŠ æœåŠ¡å™¨çš„ SSH å…¬é’¥

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
ssh root@47.100.82.151 << 'EOF'
mkdir -p ~/.ssh
chmod 700 ~/.ssh
# ç¼–è¾‘ authorized_keysï¼Œæ·»åŠ ä½ çš„ SSH å…¬é’¥
vim ~/.ssh/authorized_keys
EOF
```

æˆ–ç›´æ¥è¿½åŠ ï¼š

```bash
cat ~/.ssh/id_ed25519.pub | ssh root@47.100.82.151 "cat >> ~/.ssh/authorized_keys"
```

### ç¬¬ 5 æ­¥ï¼šæäº¤å¹¶æ¨é€ï¼ˆè§¦å‘è‡ªåŠ¨éƒ¨ç½²ï¼‰

```bash
# æäº¤é…ç½®æ–‡ä»¶
git add .github/workflows/deploy.yml GITHUB_ACTIONS_SETUP.md
git commit -m "ci: æ·»åŠ  GitHub Actions è‡ªåŠ¨éƒ¨ç½²"

# æ¨é€åˆ° GitHub
git push origin master
```

### ç¬¬ 6 æ­¥ï¼šéªŒè¯éƒ¨ç½²

1. è¿›å…¥ GitHub é¡¹ç›®
2. **Actions** æ ‡ç­¾é¡µ
3. æŸ¥çœ‹æœ€æ–°çš„ workflow è¿è¡ŒçŠ¶æ€

### æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—

```bash
# åœ¨ GitHub Actions é¡µé¢ç‚¹å‡»æœ€æ–° run
# æˆ–ä½¿ç”¨ GitHub CLI
gh run list
gh run view <run-id>
```

### ä½•æ—¶ä½¿ç”¨
- ğŸ¢ ä¼ä¸šçº§åº”ç”¨
- ğŸ‘¥ å¤§å›¢é˜Ÿåä½œ
- ğŸ§ª éœ€è¦è‡ªåŠ¨åŒ–æµ‹è¯•
- ğŸ“Š éœ€è¦éƒ¨ç½²è®°å½•å’Œå®¡è®¡
- ğŸ”” éœ€è¦éƒ¨ç½²é€šçŸ¥

---

## ğŸ“‹ æ–¹æ¡ˆ 4ï¼šç»¼åˆè„šæœ¬ï¼ˆäº¤äº’å¼éƒ¨ç½²ï¼‰

### ç‰¹ç‚¹
- âœ… äº¤äº’å¼ç•Œé¢ï¼Œæ˜“äºæ“ä½œ
- âœ… ç»“åˆ GitHub + æœåŠ¡å™¨æ¨é€
- âœ… æä¾›è¯¦ç»†åé¦ˆ
- âœ… é€‚åˆå¼€å‘é˜¶æ®µ
- âš ï¸ éœ€è¦å¤šæ­¥ç¡®è®¤
- âš ï¸ ä¾èµ– Git é…ç½®

### ä½¿ç”¨æ­¥éª¤

```bash
# 1. ç¡®ä¿å·²é…ç½® GitHub å’Œ Server è¿œç¨‹
git remote -v

# 2. æ‰§è¡Œç»¼åˆéƒ¨ç½²è„šæœ¬
chmod +x deploy-full.sh
./deploy-full.sh "feat: æ–°å¢ç™»å½•åŠŸèƒ½"

# 3. æ ¹æ®æç¤ºç¡®è®¤å„ä¸ªæ­¥éª¤
```

### è„šæœ¬åšäº†ä»€ä¹ˆ

```
ğŸ“ æäº¤æœ¬åœ°æ”¹åŠ¨  â†’  ğŸ“¤ æ¨é€åˆ° GitHub  â†’  ğŸ“¤ æ¨é€åˆ°æœåŠ¡å™¨  â†’  ğŸš€ è‡ªåŠ¨éƒ¨ç½²  â†’  ğŸ“Š æ˜¾ç¤ºçŠ¶æ€
```

### ä½•æ—¶ä½¿ç”¨
- ğŸ‘¨â€ğŸ’» å¼€å‘æµ‹è¯•
- ğŸ“Š éœ€è¦çœ‹å®Œæ•´çš„éƒ¨ç½²è¿‡ç¨‹
- ğŸ” éœ€è¦é€æ­¥ç¡®è®¤æ¯ä¸ªæ­¥éª¤
- ğŸ“ˆ å°è§„æ¨¡é¡¹ç›®

---

## ğŸ“ æ¨èä½¿ç”¨æ–¹æ¡ˆ

### æ ¹æ®åœºæ™¯é€‰æ‹©ï¼š

**å¿«é€Ÿæµ‹è¯• / ç´§æ€¥ä¿®å¤**
```bash
â†’ ä½¿ç”¨æ–¹æ¡ˆ 1ï¼šSSH ç›´æ¥æ‰§è¡Œ
./deploy-remote.sh
```

**å°å›¢é˜Ÿæ—¥å¸¸å¼€å‘**
```bash
â†’ ä½¿ç”¨æ–¹æ¡ˆ 2 æˆ– 4ï¼šGit Hook / ç»¼åˆè„šæœ¬
git push server master
æˆ–
./deploy-full.sh "æäº¤ä¿¡æ¯"
```

**ä¼ä¸šçº§ç”Ÿäº§ç¯å¢ƒ**
```bash
â†’ ä½¿ç”¨æ–¹æ¡ˆ 3ï¼šGitHub Actions
git push origin master  # è‡ªåŠ¨è§¦å‘
```

**å®Œæ•´çš„ CI/CD + è‡ªåŠ¨éƒ¨ç½²**
```bash
â†’ ç»„åˆæ–¹æ¡ˆ 3ï¼šGitHub Actions + æµ‹è¯•
1. æ¨é€ä»£ç  â†’ è‡ªåŠ¨è¿è¡Œæµ‹è¯•
2. æµ‹è¯•é€šè¿‡ â†’ è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨
3. éƒ¨ç½²æˆåŠŸ â†’ Slack é€šçŸ¥
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### æ–¹æ¡ˆ 1ï¼šSSH è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ SSH è¿æ¥
ssh -v root@47.100.82.151

# æ£€æŸ¥ SSH å¯†é’¥æƒé™
chmod 600 ~/.ssh/id_rsa
chmod 700 ~/.ssh
```

### æ–¹æ¡ˆ 2ï¼šGit Hook ä¸æ‰§è¡Œ
```bash
# æ£€æŸ¥ hook æƒé™
ssh root@47.100.82.151 "ls -la /var/repo/my-next-app.git/hooks/"

# æ£€æŸ¥æ—¥å¿—
ssh root@47.100.82.151 "tail /var/log/my-next-app-deploy.log"
```

### æ–¹æ¡ˆ 3ï¼šGitHub Actions è¶…æ—¶
```yaml
# åœ¨ .github/workflows/deploy.yml ä¸­å¢åŠ è¶…æ—¶æ—¶é—´
jobs:
  deploy:
    timeout-minutes: 30  # å¢åŠ åˆ° 30 åˆ†é’Ÿ
```

### æ–¹æ¡ˆ 4ï¼šGit è¿œç¨‹é…ç½®é”™è¯¯
```bash
# æŸ¥çœ‹æ‰€æœ‰è¿œç¨‹
git remote -v

# åˆ é™¤é”™è¯¯çš„è¿œç¨‹
git remote remove server

# é‡æ–°æ·»åŠ 
git remote add server root@47.100.82.151:/var/repo/my-next-app.git
```

---

## ğŸ“ å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹è¿œç¨‹ä»“åº“
git remote -v

# æŸ¥çœ‹åˆ†æ”¯
git branch -a

# æŸ¥çœ‹æäº¤æ—¥å¿—
git log --oneline -10

# æŸ¥çœ‹æœåŠ¡å™¨éƒ¨ç½²æ—¥å¿—
ssh root@47.100.82.151 "tail -20 /var/log/my-next-app-deploy.log"

# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
ssh root@47.100.82.151 "pm2 status"

# SSH è¿æ¥åˆ°æœåŠ¡å™¨
ssh root@47.100.82.151

# æŸ¥çœ‹ GitHub Actions æ—¥å¿—
gh run list
gh run view <run-id>
```

---

## ğŸ¯ æ€»ç»“

| éœ€æ±‚ | æ¨èæ–¹æ¡ˆ |
|-----|--------|
| å¿«é€Ÿæµ‹è¯• | â­ æ–¹æ¡ˆ 1 |
| æ—¥å¸¸å¼€å‘ | â­â­ æ–¹æ¡ˆ 2 æˆ– 4 |
| ç”Ÿäº§ç¯å¢ƒ | â­â­â­ æ–¹æ¡ˆ 3 |
| å…¨è‡ªåŠ¨åŒ– | â­â­â­ æ–¹æ¡ˆ 3 + æµ‹è¯• |

é€‰æ‹©æœ€é€‚åˆä½ çš„æ–¹æ¡ˆï¼Œå¼€å§‹è‡ªåŠ¨åŒ–éƒ¨ç½²å§ï¼ğŸš€
